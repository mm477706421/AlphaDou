# AlphaDou API 服务

这是基于AlphaDou项目的API服务，提供了斗地主AI的出牌和叫分功能。

## 安装依赖

确保已安装所有必要的依赖：

```bash
pip install -r requirements.txt
```

## 启动服务

使用以下命令启动API服务：

```bash
python run_api_server.py --host 0.0.0.0 --port 5000 --gpu_device 0
```

参数说明：
- `--host`: 服务器主机地址，默认为0.0.0.0（所有网络接口）
- `--port`: 服务器端口，默认为5000
- `--debug`: 是否开启调试模式，默认关闭
- `--gpu_device`: 使用的GPU设备，默认为空（使用CPU）

## API 接口

### 1. 出牌接口

**URL**: `/sandou_act`

**方法**: POST

**请求参数**:

```json
{
    "player_position": "landlord_down",  // 玩家位置：landlord（地主）、landlord_down（地主下家）、landlord_up（地主上家）
    "player_hand_cards": "[3, 4, 5, 6, 6, 7, 8, 8, 8, 10, 10, 10, 11, 12, 12, 13, 17]",  // 当前手牌，文本格式
    "three_landlord_cards": "[8, 9, 9]",  // 三张地主牌，文本格式
    "card_play_action_seq": "[[9, 9, 9, 3]]",  // 出牌历史，文本格式。空为[]，一手牌为[[9, 9, 9, 3]]，多手牌为[[9, 9, 9, 3], [10, 10, 10, 5]]
    "bid_info": "[3, -1, -1]",  // 叫分信息，文本格式。例如：第一家不叫，第二家叫2分，第三家不叫为[0, 2, -1]
    "passwd": "12345678"  // 密码，固定为12345678
}
```

**响应**:

```json
{
    "action": "[6, 10, 10, 10]",  // 返回的出牌动作，文本格式
    "code": 0  // 状态码，0表示成功
}
```

### 2. 叫地主接口

**URL**: `/sandou_bid`

**方法**: POST

**请求参数**:

```json
{
    "player_position": "third",  // 玩家位置：first（第一个叫牌）、second（第二个叫牌）、third（第三个叫牌）
    "player_hand_cards": "[3, 3, 4, 4, 5, 5, 6, 8, 10, 10, 11, 11, 12, 12, 13, 13, 17]",  // 当前手牌，文本格式
    "bid_info": "[-1, -1, -1]",  // 叫分信息，文本格式。例如：第一家不叫，第二家叫3分，第三家未叫为[0, 3, -1]
    "bid_model": 0,  // 叫牌模型，固定为0
    "passwd": "12345678"  // 密码，固定为12345678
}
```

**响应**:

```json
{
    "action": "[2]",  // 返回的叫分动作，文本格式。[0]表示不叫，[1]表示1分，[2]表示2分，[3]表示3分
    "code": 0  // 状态码，0表示成功
}
```

## 测试API

可以使用提供的测试脚本来测试API：

```bash
python test_api.py
```

## 卡牌编码

卡牌编码如下：
- 3, 4, 5, 6, 7, 8, 9, 10, J, Q, K, A, 2, 小王, 大王
- 对应的数值为：3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 17, 20, 30

## 注意事项

1. 确保模型文件在正确的位置（baseline/best/目录下）
2. API服务需要较大的内存和计算资源，特别是在使用GPU时
3. 密码验证是简单的固定密码（12345678），可以根据需要修改为更安全的验证方式 